<!DOCTYPE html>
<html>

<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>
	<!-- <script src="scripts/sketch.js"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.js"></script>
	<script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
	<script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
	<script src="https://unpkg.com/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
	<script src="https://unpkg.com/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
	<!-- <script src="microsoft.cognitiveservices.speech.sdk.bundle.js"></script> -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- <link rel="stylesheet" type="text/css" href="stylesheets/styles.css"> -->
	<link rel="stylesheet" href="stylesheets/normalize.css">
	<link rel="stylesheet" href="stylesheets/skeleton.css">
	<link rel="icon" type="image/png" href="images/icon.png">
	<title>Lifeography of Wenjun II</title>
</head>

<body class="body">


	<video id="video1" autoplay loop muted style="display:none">
		<source src="videos/wenjuniinewrotate.mp4" type="video/mp4">
	</video>

	<video id="video2" autoplay loop muted style="display:none">
		<source src="videos/wenjuniinew.mp4" type="video/mp4">
	</video>


	<div id="3d10">
		<script>
			console.log('SCRIPT LOADED');

			let mesh3 = null;
			let mesh4 = null;
			let mesh5 = null;
			let mesh6 = null;
			let mesh7 = null;
			let mesh8 = null;
			let mesh9 = null;
			// let cube = null;
			let texture3, texture4, texture5, texture6, texture7, texture8, texture9;
			let myMixer;

			let sketch = function (p) {
				// let r = 0;
				let loaded = false;
				let random1, random4, random8, random11;
				let h, s, l, a, q, n;
				let table1, table4, table8, table11;
				let columnData1 = [];
				let columnData4 = [];
				let columnData8 = [];
				let columnData11 = [];
				let env1, env4, env8, env11;
				let osc1, osc4, osc8, osc11;
				let randomSound1, randomSound4, randomSound8, randomSound11;
				let textArray = [];
				let randomText;

				p.preload = function () {
					table1 = p.loadTable('csv/healthdata_active_calories.csv', 'csv', 'header', p.onTableLoaded);
					table4 = p.loadTable('csv/healthdata_activity_intensity.csv', 'csv', 'header', p.onTableLoaded);
					table8 = p.loadTable('csv/healthdata_heart_rate.csv', 'csv', 'header', p.onTableLoaded);
					table11 = p.loadTable('csv/healthdata_stress_level.csv', 'csv', 'header', p.onTableLoaded);
				};

				p.onTableLoaded = function () {
					console.log('CSV file loaded successfully');
					console.log(table1.getRowCount() + ' rows loaded');
					console.log(table4.getRowCount() + ' rows loaded');
					console.log(table8.getRowCount() + ' rows loaded');
					console.log(table11.getRowCount() + ' rows loaded');
					for (let i = 0; i < table1.getRowCount(); i++) {
						let row1 = table1.getRow(i);
						columnData1.push(row1.get('active_calories'));
					};
					for (let j = 0; j < table4.getRowCount(); j++) {
						let row4 = table4.getRow(j);
						columnData4.push(row4.get('activity_intensity'));
					}
					for (let k = 0; k < table8.getRowCount(); k++) {
						let row8 = table8.getRow(k);
						columnData8.push(row8.get('heart_rate'));
					}
					for (let m = 0; m < table11.getRowCount(); m++) {
						let row11 = table11.getRow(m);
						columnData11.push(row11.get('stress_level'));
					}
					console.log(columnData1);
					console.log(columnData4);
					console.log(columnData8);
					console.log(columnData11);
					loaded = true;
				}

				p.setup = function () {
					p.createCanvas(800, 800);
					p.colorMode(p.HSL);
					p.angleMode(p.DEGREES);
					addMesh1();
					p.frameRate(2);
				}

				p.draw = function () {
					random1 = p.int(p.random(1, 938471));
					random4 = p.int(p.random(1, 938470));
					random8 = p.int(p.random(1, 938471));
					random11 = p.int(p.random(1, 938469));
					randomText = p.random(textArray);
					if (loaded) {
						// p.background(0);
						p.fill(p.random(0, 360), p.random(0, 100), p.random(0, 100), p.random(0, 0.3));
						p.textSize(p.random(5, 15));
						p.text(columnData1[random1], p.random(p.width), p.random(p.height));
						p.fill(p.random(0, 360), p.random(0, 100), p.random(0, 100), p.random(0, 0.3));
						p.textSize(p.random(5, 15));
						p.text(columnData4[random4], p.random(p.width), p.random(p.height));
						p.fill(p.random(0, 360), p.random(0, 100), p.random(0, 100), p.random(0, 0.3));
						p.textSize(p.random(5, 15));
						p.text(columnData8[random8], p.random(p.width), p.random(p.height));
						p.fill(p.random(0, 360), p.random(0, 100), p.random(0, 100), p.random(0, 0.3));
						p.textSize(p.random(5, 15));
						p.text(columnData11[random11], p.random(p.width), p.random(p.height));
						textArray = ["dream", "life", "time", "sewing", "smile", "笑容", "生活", "little boy", "night", "beaten", "happy", "开心", "打", "学校", "hide", "grandma", "protect", "laughter", "safe haven", "academic performance", "obedience", "junior captain", "squadron leader", "three good student", "mother", "lie", "sound", "fall asleep", "hand", "lift", "bed", "cold", "son", "family", "cry", "school", "model student", "家", "儿子", "笑声", "奶奶", "避难所", "哭", "时间", "成绩", "听话", "小队长", "中队长", "三好学生", "模范学生"];
						p.fill(p.random(0, 360), p.random(0, 100), p.random(0, 100), p.random(0, 0.3));
						p.textSize(p.random(5, 15));
						p.text(randomText, p.random(p.width), p.random(p.height));
					}
				}
			};

			const scene = new THREE.Scene();
			const myCamera = new THREE.OrthographicCamera(window.innerWidth / - 3, window.innerWidth / 3, window.innerHeight / 3, window.innerHeight / - 3, 0.001, 2000);
			myCamera.position.set(0, 0, 1000);
			// myCamera.zoom = 10;
			const renderer = new THREE.WebGLRenderer({ alpha: true });
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.setClearColor(0xcccccc);
			renderer.setPixelRatio(3);
			document.getElementById('3d10').appendChild(renderer.domElement);

			scene.background = new THREE.Color('rgb(25, 25, 25)');

			const loader = new THREE.GLTFLoader();

			const controls = new THREE.OrbitControls(myCamera, renderer.domElement);

			// controls.target = new THREE.Vector3(0, 0, 0);

			const video1 = document.getElementById('video1');
			const texture1 = new THREE.VideoTexture(video1);

			const video2 = document.getElementById('video2');
			const texture2 = new THREE.VideoTexture(video2);

			const clock = new THREE.Clock();



			loader.load('models/wenjuniinew.glb', function (gltf) {
				gltf.scene.traverse(child => {
					if (child.material) child.material.metalness = 0;
				});

				gltf.scene.traverse((object) => {
					const encoding = THREE.sRGBEncoding;
					if (object.isMesh) {
						const material = object.material;
						if (material.map) material.map.encoding = encoding;
						if (material.emissiveMap) material.emissiveMap.encoding = encoding;
						if (material.map || material.emissiveMap) material.needsUpdate = true;

						console.log(object.material);
					}
				});

				gltf.scene.traverse(function (object) { object.frustumCulled = false; });

				const material1 = gltf.scene.getObjectByName('wenjunii').material;
				material1.map = texture1;
				texture1.offset.y = -0.03;
				video1.play();
				texture1.needsUpdate = true;


				const material2 = gltf.scene.getObjectByName('SuperShapesMesh004').material;
				material2.map = texture2;
				texture2.offset.y = -0.03;
				// texture2.offset.x = 0.03;
				video2.play();
				texture2.needsUpdate = true;

				myMixer = new THREE.AnimationMixer(gltf.scene);
				const animations = gltf.animations;

				gltf.animations.forEach(animation => {
					myMixer.clipAction(animation).play();
				});

				scene.add(gltf.scene);


				scene.add(gltf.scene);
				scene.position.set(0, 0, 0);
				gltf.scene.position.set(0, 0, 0);
				gltf.scene.scale.set(10, 10, 10);
				addLights();
				console.log('GLTF LOAD');
			}, undefined, function (error) {
				console.log('GLTF ERROR');
				console.error(error);
			});

			function addLights() {
				console.log('LIGHTS')
				const directionlight = new THREE.DirectionalLight(0xffffff, 0.5);
				scene.add(directionlight);
				const ambientlightprobe = new THREE.AmbientLightProbe(0xffffff5, 0.8);
				scene.add(ambientlightprobe);
			}

			let myp5 = new p5(sketch);
			setTimeout(() => {
				if (myp5.canvas) {
					myp5.canvas.style.display = 'none';
				}
			}, 1000);

			function addMesh1() {
				texture3 = new THREE.Texture();
				texture3.image = myp5.canvas;
				texture3.needsUpdate = true;
				let material3 = new THREE.MeshBasicMaterial({ map: texture3 });
				let geometry3 = new THREE.PlaneGeometry(800, 800);
				mesh3 = new THREE.Mesh(geometry3, material3);
				scene.add(mesh3);
				mesh3.position.set(0, 0, -100);
				animate();
			}

			const loader2 = new THREE.OBJLoader();
			loader2.load('models/randomshape/randomshape1.obj', function (object2) {
				object2.scale.set(8, 8, 8);
				object2.position.set(-120, -300, 50);
				object2.rotation.set(0, 180, 0);
				scene.add(object2);
			});

			const loader3 = new THREE.OBJLoader();
			loader3.load('models/randomshape/randomshape2.obj', function (object3) {
				object3.scale.set(8, 8, 8);
				object3.position.set(200, 0, 150);
				object3.rotation.set(0, 0, 0);
				scene.add(object3);
			});

			const loader4 = new THREE.OBJLoader();
			loader4.load('models/randomshape/randomshape3.obj', function (object4) {
				object4.scale.set(8, 8, 8);
				object4.position.set(-200, 200, 20);
				object4.rotation.set(0, 0, 0);
				scene.add(object4);
			});

			const loader5 = new THREE.OBJLoader();
			loader5.load('models/randomshape/randomshape4.obj', function (object5) {
				object5.scale.set(8, 8, 8);
				object5.position.set(-300, -200, 120);
				object5.rotation.set(0, 0, 0);
				scene.add(object5);
			});

			const loader6 = new THREE.OBJLoader();
			loader6.load('models/randomshape/randomshape5.obj', function (object6) {
				object6.scale.set(8, 8, 8);
				object6.position.set(-10, -100, -50);
				object6.rotation.set(0, 180, 0);
				scene.add(object6);
			});

			const loader7 = new THREE.OBJLoader();
			loader7.load('models/randomshape/randomshape6.obj', function (object7) {
				object7.scale.set(8, 8, 8);
				object7.position.set(250, 300, 200);
				object7.rotation.set(0, 0, 0);
				scene.add(object7);
			});

			const loader8 = new THREE.OBJLoader();
			loader8.load('models/randomshape/randomshape7.obj', function (object8) {
				object8.scale.set(8, 8, 8);
				object8.position.set(280, -260, 230);
				object8.rotation.set(0, 180, 0);
				scene.add(object8);
			});

			const loader9 = new THREE.OBJLoader();
			loader9.load('models/randomshape/randomshape8.obj', function (object9) {
				object9.scale.set(8, 8, 8);
				object9.position.set(-100, 40, 280);
				object9.rotation.set(0, 180, 0);
				scene.add(object9);
			});

			const loader10 = new THREE.OBJLoader();
			loader10.load('models/randomshape/randomshape9.obj', function (object10) {
				object10.scale.set(8, 8, 8);
				object10.position.set(130, -180, 340);
				object10.rotation.set(0, 180, 0);
				scene.add(object10);
			});

			function animate() {
				requestAnimationFrame(animate);
				controls.update();
				renderer.render(scene, myCamera);
				texture3.needsUpdate = true;
				if (myMixer) {
					const delta = clock.getDelta();
					myMixer.update(delta);
				}
				// object2.rotation.y += 0.01;
			};

		</script>

</body>

</html>